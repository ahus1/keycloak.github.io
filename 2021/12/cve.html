
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Keycloak - Blog - Important security vulnerability discovered</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Keycloak is an open source identity and access management solution">
    <meta name="author" content="Keycloak Team">
    <meta name="keywords" content="sso,idm,openid connect,saml,kerberos,ldap">

    

    <meta http-equiv='Content-Security-Policy' content="default-src 'none'; style-src 'self'; img-src 'self' https://www.google-analytics.com; font-src 'self'; script-src 'self' https://www.google-analytics.com; connect-src 'self' https://www.google-analytics.com; base-uri 'none'; form-action 'none';">

    <link href="https://www.keycloak.org/resources/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://www.keycloak.org/resources/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://www.keycloak.org/resources/css/keycloak.css" rel="stylesheet">

    <link rel="shortcut icon" href="https://www.keycloak.org/resources/favicon.ico">

    <script src="https://www.keycloak.org/resources/js/ga.js" type="text/javascript"></script>
    <script src="https://www.keycloak.org/resources/js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="https://www.keycloak.org/resources/js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body>
<div id="wrap">
<header class="main-header">
    <div class="container">
        <div class="row">
            <div class="col-md-3 col-sm-3 col-xs-12 keycloak-logo-div navbar-header">
                <button type="button" class=" pull-right  navbar-toggle collapsed" data-toggle="collapse" data-target="#mainBtnTarget" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="https://www.keycloak.org/" title="Keycloak" class="keycloak-logo-a">
                    <img class="keycloak-logo" src="https://www.keycloak.org/resources/images/keycloak_logo_480x108.png" border="0" alt="Keycloak"/>
                </a>
            </div>
            <div id="mainBtnTarget" class="col-md-9 col-sm-9 col-xs-12 collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="https://www.keycloak.org/getting-started">Get Started</a></li>
                    <li><a href="https://www.keycloak.org/documentation">Docs</a></li>
                    <li><a href="https://www.keycloak.org/downloads">Downloads</a></li>
                    <li><a href="https://www.keycloak.org/community">Community</a></li>
                    <li><a href="https://www.keycloak.org/blog">Blog</a></li>
                </ul>
            </div>
        </div>
    </div>
</header>

<div class="page-section">
    <div class="container blog">
        <h1>Important security vulnerability discovered</h1>
        <p class="blog-date">Thursday, December 23 2021, posted by Stian Thorgersen</p>


<div class="paragraph">
<p>A flaw (<a href="https://access.redhat.com/security/cve/CVE-2021-4133">CVE-2021-4133</a>) was found in Keycloak version from 12.0.0 and before 15.1.1 which allows an attacker with any existing user account to create new default user accounts via the administrative REST API even when new user registration is disabled.</p>
</div>
<div class="paragraph">
<p>In most situations the newly created user is the equivalent of a self-registered user, and does not have the ability to receive any additional roles or groups. However, there are some vectors that are harder to reproduce, but may result in additional privileges.</p>
</div>
<div class="paragraph">
<p>We highly recommend everyone upgrade to Keycloak 15.1.1 or 16.1.0 as soon as possible. Keycloak 16.0.0 also includes the fix, but if you are not already running this version we recommend going straight to 16.1.0.</p>
</div>
<div class="paragraph">
<p>If you are unable to upgrade we recommend mitigate the issue by blocking access to the user creation REST endpoint in the interim.</p>
</div>
<div class="paragraph">
<p>This can be achieved with the following CLI commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">bin/jboss-cli.sh --connect
/subsystem=undertow/configuration=filter/expression-filter=keycloakPathOverrideUsersCreateEndpoint:add( \
  expression="(regex('^/auth/admin/realms/(.*)/users$') and method(POST))-&gt; response-code(400)" \
)
/subsystem=undertow/server=default-server/host=default-host/filter-ref=keycloakPathOverrideUsersCreateEndpoint:add()</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will block both valid and invalid attempts at creating new users, including requests from the Keycloak admin console.</p>
</div>
<div class="paragraph">
<p>Alternatively, the path <code>/auth/admin/realms/.*/users</code> and method <code>POST</code>, or <code>/auth/admin</code> completely, can be blocked with a firewall.</p>
</div>
<div class="paragraph">
<p>For more information about the flaw please view <a href="https://access.redhat.com/security/cve/CVE-2021-4133">CVE-2021-4133</a> and <a href="https://github.com/keycloak/keycloak/security/advisories/GHSA-83x4-9cwr-5487">GHSA-83x4-9cwr-5487</a>.</p>
</div>    </div>
</div>
		</div>
		<div id="push"></div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-sm-9 col-xs-12">
                    <a href="http://www.redhat.com/" target="_blank">
                        <img alt="redhatlogo-white" src="https://www.keycloak.org/resources/images/redhatlogo-white.png" width="130">
                    </a>
                </div>
            </div>
        </div>
    </div>
  </body>
</html>